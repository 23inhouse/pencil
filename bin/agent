#!/usr/bin/env ruby

require_relative '../lib/pencil'

puts Pencil::Version.to_s
docker = Pencil::Docker.new

# Perform Periodic Synchronization
while true do

  docker.resync.each do |id, data|
    puts "syncing #{id}"
    consul = Pencil::Consul.new(host: 'localhost', port: 8500)
    consul.register_service(service_id: data['Id'],
                            service_name: data['image'],
                            host_port: data['host_port'] )
  end

  sleep 2
end
